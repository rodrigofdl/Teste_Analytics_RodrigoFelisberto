---
title: "Análise de Dados de Vendas"
author: "Rodrigo Felisberto"
date: "22/11/2024"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Limpeza e Análise de Dados de Vendas

## Pacotes carregados:

```{r}
# Instala os pacotes necessários (se ainda não estiverem instalados)
if (!require(dplyr)) install.packages("dplyr")
if (!require(tidyr)) install.packages("tidyr")
if (!require(ggplot2)) install.packages("ggplot2")
if (!require(scales)) install.packages("scales")

# Carrega os pacotes
library(dplyr)
library(tidyr)
library(ggplot2)
```

## Criação do script para simular um dataset de vendas:

```{r}
# Função para gerar dataset de vendas
gerar_dados_vendas <- function(n = 50) {
  
  # Define a semente para reprodutibilidade
  set.seed(123)
  
  # Produtos, categorias e preços fixos
  produto_info <- data.frame(
    Produto = c("Notebook", "Smartphone", "Mouse", "Teclado", "Fone de Ouvido"),
    Categoria = c("Eletronicos", "Eletronicos", "Acessorios", "Acessorios", "Acessorios"),
    Preco = c(3500, 2000, 100, 150, 200)
  )
  
  # Cria os dados simulados
  dados_vendas <- data.frame(
    ID = 1:n,
    Data = sample(seq(as.Date("2023-01-01"), as.Date("2023-12-31"), by = "day"), n, replace = TRUE),
    Produto = sample(produto_info$Produto, n, replace = TRUE),
    Quantidade = sample(1:30, n, replace = TRUE)
  )
  
  # Associa categorias e preços ao dataset de vendas
  dados_vendas <- merge(dados_vendas, produto_info, by = "Produto", all.x = TRUE)
  
  # Introduz valores ausentes aleatórios
  dados_vendas[sample(1:n, 5), "Produto"] <- NA
  
  # Introduz duplicatas aleatórias
  duplicatas <- dados_vendas[sample(1:n, 3), ]
  dados_vendas <- rbind(dados_vendas, duplicatas)
  
  return(dados_vendas)
}

# Gera o dataset
data_raw <- gerar_dados_vendas(100)

# Visualiza o dataset
print(data_raw)

# Salva o dataset como um arquivo CSV
write.csv(data_raw, "data_raw.csv", row.names = FALSE)
```

## Limpeza dos dados:

```{r}
# Carrega os dados brutos
dados_vendas <- read.csv("data_raw.csv")

# Verifica a estrutura dos dados
summary(dados_vendas)
glimpse(dados_vendas)

# Verifica valores ausentes nas colunas
colSums(is.na(dados_vendas))

# Remove valores ausentes
dados_vendas_limpo <- dados_vendas[complete.cases(dados_vendas), ]

# Remove duplicatas
dados_vendas_limpo <- dados_vendas_limpo[!duplicated(dados_vendas_limpo), ]

# Ordena o data frame, em ordem crescente, por data
dados_vendas_limpo <- arrange(dados_vendas_limpo, dados_vendas_limpo$Data)

# Visualiza o dataset limpo
print(dados_vendas_limpo)

# Salva o dataset limpo
write.csv(dados_vendas_limpo, "data_clean.csv", row.names = FALSE)
```

## Análise de dados de vendas:

```{r}
# Carrega os dados limpos
dados_vendas_limpo <- read.csv("data_clean.csv")

# Converte "Data" para Date
dados_vendas_limpo$Data <- as.Date(dados_vendas_limpo$Data)

# Calcula o total de vendas
dados_vendas_limpo$Total <- dados_vendas_limpo$Quantidade * dados_vendas_limpo$Preco

# Agrega o total por produto
totais_por_produto <- dados_vendas_limpo %>%
  group_by(Produto) %>%
  summarise(
    Total_Quantidade = sum(Quantidade),
    Total_Vendas = sum(Total)
  ) %>% 
  arrange(desc(Total_Vendas))

# Visualiza o calculo de vendas totais
print(dados_vendas_limpo)

# Visualiza os totais por produto
print(totais_por_produto)
```

# Análise Exploratória de Dados de Vendas

```{r}
# Agrega os dados por mês
dados_mensais <- dados_vendas_limpo %>%
  mutate(Mes = format(Data, "%Y-%m")) %>%
  group_by(Mes) %>%
  summarise(Total_Vendas_Mes = sum(Total)) %>%
  arrange(Mes)

# Converte Mes novamente para Date
dados_mensais$Mes <- as.Date(paste0(dados_mensais$Mes, "-01"))

# Cria o gráfico de linha
ggplot(dados_mensais, aes(x = Mes, y = Total_Vendas_Mes)) +
  geom_line(color = "blue", size = 1) +
  geom_point(color = "blue", size = 2) +
  scale_x_date(
    date_labels = "%b",
    date_breaks = "1 month",
    expand = c(0, 0)
  ) +
  scale_y_continuous(labels = label_number(big.mark = ".", decimal.mark = ",")) +
  labs(
    title = "Tendência das Vendas Mensais em 2023",
    x = "Mês",
    y = "Total de Vendas (R$)"
  ) +
  theme_light()
```
